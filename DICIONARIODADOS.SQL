CREATE DATABASE DICIONARIODADOS;
USE DICIONARIODADOS;

CREATE TABLE CLIENTE(
    IDCLIENTE INT,
    NOME VARCHAR(30),
    EMAIL VARCHAR(100)
);

-- ADICIONANDO UMA PK
ALTER TABLE CLIENTE
ADD PRIMARY KEY (IDCLIENTE);

ALTER TABLE CLIENTE
MODIFY IDCLIENTE INT AUTO_INCREMENT;

-- ADICIONAND UMA COLUNA
ALTER TABLE CLIENTE
ADD IDADE DATETIME NOT NULL

DESC CLIENTE;

ALTER TABLE CLIENTE
ADD CPF VARCHAR(10);

-- MODIFICANDO  TIPO DE UM CAMPO
ALTER TABLE CLIENTE
MODIFY CPF VARCHAR(11) NOT NULL UNIQUE

DESC CLIENTE;

-- ADICIONANDO FOREIGN KEY
CREATE TABLE COMPRA(
    ID INT,
    TITULO VARCHAR(30),
    DESCRICAO VARCHAR(200),
    ID_CLIENTE INT
);

ALTER TABLE COMPRA
ADD PRIMARY KEY(ID);

ALTER TABLE COMPRA
CHANGE ID IDCOMPRA INT AUTO_INCREMENT;

ALTER TABLE COMPRA
ADD FOREIGN KEY (ID_CLIENTE)
REFERENCES CLIENTE(IDCLIENTE);

-- DESCRIÇÃO COMPLETA DA TABELA;
SHOW CREATE TABLE COMPRA;

-- ORGANIZAÇÃO DAS CHAVES -  CONSTRAINT
/*
    PK - trata todo registro como sendo único
    FK - cuida da integridade referencial, ou seja se eu inserir um registro em um coluna que é fk eu necessariamente tenho que ter um registro compativel na tabela referenciada
*/

CREATE TABLE JOGADOR (
    IDJOGADOR INT PRIMARY KEY AUTO_INCREMENT,
    NOME VARCHAR(30)
);

CREATE TABLE TIMES(
    IDTIME INT PRIMARY KEY AUTO_INCREMENT,
    NOMETIME VARCHAR(30),
    ID_JOGADOR INT,
    FOREIGN KEY(ID_JOGADOR)
    REFERENCES JOGADOR(IDJOGADOR)
);

INSERT INTO JOGADOR VALUES(NULL,'GUERREIRO');
INSERT INTO TIMES VALUES(NULL,'FLAMENGO',1);
-- ERROR 1452 (23000): Cannot add or update a child row: a foreign key constraint fails (`DICIONARIODADOS`.`TIMES`, CONSTRAINT `TIMES_ibfk_1` FOREIGN KEY (`ID_JOGADOR`) REFERENCES `JOGADOR` (`IDJOGADOR`))
INSERT INTO TIMES VALUES(NULL,'FLAMENGO',2);

DROP TABLE TIMES;
DROP TABLE JOGADOR;
DROP TABLE COMPRA;
DROP TABLE CLIENTE;

/*A MELHOR MANEIRA DE CRIAR CONSTRAINT */

CREATE TABLE CLIENTE(
    IDCLIENTE INT,
    NOME VARCHAR(30) NOT NULL
);

CREATE TABLE TELEFONE(
    IDTELEFONE INT,
    TIPO CHAR(3) NOT NULL,
    NUMERO VARCHAR(10) NOT NULL,
    ID_CLIENTE INT
);

ALTER TABLE CLIENTE 
ADD  CONSTRAINT PK_CLIENTE
PRIMARY KEY(IDCLIENTE);

ALTER TABLE TELEFONE
ADD CONSTRAINT PK_TELEFONE
PRIMARY KEY (IDTELEFONE);

ALTER TABLE TELEFONE 
ADD CONSTRAINT FK_CLIENTE_TELEFONE
FOREIGN KEY (ID_CLIENTE) REFERENCES CLIENTE(IDCLIENTE);

SHOW CREATE TABLE TELEFONE;

/* DICIONARIO DE DADOS

GUARDA UM METADADOS, OU SEJA, DADOS SOBRE OS DADOS1
*/
SHOW DATABASES;

USE information_schema;

SHOW TABLES;

DESC TABLE_CONSTRAINT;
--PESQUISANDO NO DICIONARIO DE DADOS ATRAS DAS CONSTRAINT
SELECT  CONSTRAINT_SCHEMA AS "BANCO",
        TABLE_NAME AS "TABELA",
        CONSTRAINT_TYPE AS "TIPO"
        FROM TABLE_CONSTRAINTS;

SELECT  CONSTRAINT_SCHEMA AS "BANCO",
        TABLE_NAME AS "TABELA",
        CONSTRAINT_TYPE AS "TIPO",
        CONSTRAINT_NAME AS "NOME REGRA"
        FROM TABLE_CONSTRAINTS
        WHERE CONSTRAINT_SCHEMA = "DICIONARIODADOS";

+-----------------+----------+-------------+---------------------+
| BANCO           | TABELA   | TIPO        | NOME REGRA          |
+-----------------+----------+-------------+---------------------+
| DICIONARIODADOS | CLIENTE  | PRIMARY KEY | PRIMARY             |
| DICIONARIODADOS | TELEFONE | PRIMARY KEY | PRIMARY             |
| DICIONARIODADOS | TELEFONE | FOREIGN KEY | FK_CLIENTE_TELEFONE |
+-----------------+----------+-------------+---------------------+


/* APAGANDO CONSTRAINTS*/

USE DICIONARIODADOS;

SHOW CREATE TABLE TELEFONE;

ALTER TABLE TELEFONE
DROP FOREIGN KEY FK_CLIENTE_TELEFONE ; 

ALTER TABLE TELEFONE
ADD CONSTRAINT FK_CLIENTE_TELEFONE
FOREIGN KEY (ID_CLIENTE) REFERENCES CLIENTE(IDCLIENTE);
